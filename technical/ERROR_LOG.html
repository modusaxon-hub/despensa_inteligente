<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERROR LOG ‚Äî Despensa Inteligente</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;600&family=JetBrains+Mono&display=swap');

        :root {
            --green: #2d8a4e;
            --dark: #1a1a2e;
            --red: #e74c3c;
            --orange: #f39c12;
            --blue: #2980b9;
            --success: #27ae60;
        }

        @media print {
            @page {
                size: A4;
                margin: 2.5cm 2cm;
            }

            body {
                background: white !important;
            }

            .no-print {
                display: none;
            }

            .page-break {
                page-break-before: always;
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            color: #1a1a1a;
            line-height: 1.6;
            background: #f0f2f5;
            margin: 0;
            padding: 40px;
        }

        .paper-a4 {
            background: white;
            max-width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 30px 40px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2,
        h3 {
            font-family: 'Playfair Display', serif;
            color: var(--dark);
        }

        h1 {
            border-bottom: 3px solid var(--red);
            padding-bottom: 15px;
            font-size: 2em;
        }

        h2 {
            border-left: 4px solid var(--green);
            padding-left: 12px;
            margin-top: 30px;
        }

        .hook {
            background: #fff3cd;
            border-left: 5px solid var(--orange);
            padding: 15px;
            margin-bottom: 25px;
            font-style: italic;
        }

        .error-entry {
            border: 1px solid #eee;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            page-break-inside: avoid;
        }

        .error-header {
            background: #fdedec;
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .error-header h3 {
            margin: 0;
            color: var(--red);
            font-family: 'Inter', sans-serif;
            font-size: 1em;
        }

        .error-body {
            padding: 15px;
        }

        .error-cause {
            background: #fef9e7;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .solution {
            border-left: 4px solid #ccc;
            padding: 10px 15px;
            margin: 10px 0;
        }

        .solution.winner {
            border-left-color: var(--success);
            background: #eafaf1;
        }

        .solution.failed {
            border-left-color: var(--red);
            background: #fdedec;
        }

        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            color: white;
        }

        .tag-error {
            background: var(--red);
        }

        .tag-ok {
            background: var(--success);
        }

        .tag-fail {
            background: #95a5a6;
        }

        .tag-date {
            background: var(--blue);
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 5px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8em;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background: #f8f8f8;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8em;
        }

        .footer {
            margin-top: 50px;
            font-size: 0.75em;
            text-align: center;
            color: #aaa;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
    </style>
</head>

<body>
    <div class="paper-a4">
        <header>
            <div
                style="color: var(--red); font-weight: bold; font-size: 0.8em; letter-spacing: 0.2em; text-transform: uppercase;">
                Despensa Inteligente ‚Äî Error Log</div>
            <h1>üêõ ERROR_LOG: Bit√°cora de Errores y Soluciones</h1>
        </header>

        <div class="hook">
            <strong>Prop√≥sito:</strong> Registrar CADA error enfrentado durante el desarrollo, las soluciones intentadas
            (fallidas y exitosas), y la soluci√≥n final definitiva. |
            <strong>Riesgo:</strong> Sin este registro, los mismos errores se repiten en cada sesi√≥n sin referencia
            cruzada.
        </div>

        <h2>√çndice de Errores</h2>
        <table>
            <tr>
                <th>#</th>
                <th>Fecha</th>
                <th>M√≥dulo</th>
                <th>Error</th>
                <th>Estado</th>
            </tr>
            <tr>
                <td>ERR-001</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>Timeout networkidle en Ol√≠mpica</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-002</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>Selector de ubicaci√≥n no encontrado</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-003</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>Modal con 3 estados diferentes</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-004</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>0 dropdowns tras abrir trigger</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-005</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>Selector de precio Ol√≠mpica roto</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-006</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>URL de producto Ol√≠mpica 404</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-007</td>
                <td>15/02/2026</td>
                <td>BD</td>
                <td>Precio D1 aceite coco incorrecto</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-008</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>Bloque except duplicado</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-009</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>Variantes de b√∫squeda D1: 3000 vs 3.000</td>
                <td><span class="tag tag-ok">RESUELTO</span></td>
            </tr>
            <tr>
                <td>ERR-010</td>
                <td>15/02/2026</td>
                <td>Scraper</td>
                <td>0 resultados en b√∫squeda VTEX (selectores)</td>
                <td><span class="tag tag-error">EN PROGRESO</span></td>
            </tr>
        </table>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-001 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-001: Timeout networkidle en Ol√≠mpica</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <p><strong>Archivo:</strong> <code>scrapers/auto_bot.py</code> | <strong>Funci√≥n:</strong>
                    <code>set_olimpica_location()</code></p>
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> <code>wait_until="networkidle"</code> espera a que TODAS las
                    peticiones de red terminen. Ol√≠mpica carga ~50+ scripts de analytics (GTM, Meta Pixel) que nunca
                    finalizan ‚Üí timeout 60s.
                </div>
                <pre>Page.goto: Timeout 60000ms exceeded waiting for networkidle</pre>

                <div class="solution failed">
                    <strong><span class="tag tag-fail">INTENTO 1 ‚Äî FALLIDO</span></strong> Aumentar timeout a
                    120000ms<br>
                    <em>Resultado:</em> Solo retrasa el error. No resuelve la causa.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Cambiar a
                    <code>wait_until="domcontentloaded"</code><br>
                    <pre>await page.goto(url, wait_until="domcontentloaded", timeout=60000)</pre>
                    <em>Resultado:</em> Carga en ~3s. <code>domcontentloaded</code> se dispara cuando el HTML se parsea,
                    sin esperar recursos externos.
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-002 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-002: Selector de ubicaci√≥n no encontrado</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <p><strong>Archivo:</strong> <code>scrapers/auto_bot.py</code></p>
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Las clases CSS de VTEX cambian entre versiones del sitio. El
                    selector <code>.olimpica-dinamic-flags-0-x-shippingMethod</code> solo funciona en una versi√≥n.
                </div>
                <pre>Page.wait_for_selector: Timeout 10000ms exceeded</pre>

                <div class="solution failed">
                    <strong><span class="tag tag-fail">INTENTO 1 ‚Äî FALLIDO</span></strong> Usar solo
                    <code>.olimpica-dinamic-flags-0-x-shippingMethod</code><br>
                    <em>Resultado:</em> Fr√°gil; falla si VTEX cambia la versi√≥n del componente.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Selector combinado con
                    <code>.first</code>
                    <pre>page.locator(
  ".vtex-modal-layout-0-x-triggerContainer--location-delivery-info, "
  ".olimpica-dinamic-flags-0-x-shippingMethod"
).first</pre>
                    <em>Resultado:</em> Funciona con ambas versiones del selector.
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-003 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-003: Modal de ubicaci√≥n con 3 estados diferentes</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <p><strong>Archivo:</strong> <code>scrapers/auto_bot.py</code> | <strong>Funci√≥n:</strong>
                    <code>set_olimpica_location()</code></p>
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Dependiendo de cookies/sesi√≥n, Ol√≠mpica muestra 3 modales
                    diferentes:
                    <ul>
                        <li><strong>Estado A:</strong> "Env√≠o a domicilio" ‚Üí Bot√≥n "Continuar" (direcci√≥n ya guardada)
                        </li>
                        <li><strong>Estado B:</strong> "Agrega una direcci√≥n" ‚Üí Input + Bot√≥n "Confirmar"</li>
                        <li><strong>Estado C:</strong> "No tenemos cobertura" ‚Üí "IR A TIENDA OLIMPICA"</li>
                    </ul>
                </div>

                <div class="solution failed">
                    <strong><span class="tag tag-fail">INTENTO 1 ‚Äî PARCIAL</span></strong> Solo manejar Estado A (bot√≥n
                    Continuar)<br>
                    <em>Resultado:</em> Falla cuando aparece Estado B o C.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Detecci√≥n en cascada de los 3
                    estados:
                    <pre>1. ¬øBot√≥n "Continuar"? ‚Üí click ‚Üí return
2. ¬øBot√≥n "Confirmar"? ‚Üí fill("centro") ‚Üí click ‚Üí return
3. ¬øTrigger visible? ‚Üí click ‚Üí re-check ambos botones ‚Üí dropdowns</pre>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-004 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-004: 0 dropdowns encontrados tras abrir trigger</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Al hacer clic en el trigger, el modal que aparec√≠a era el de
                    "Continuar" (Estado A), NO el de dropdowns. El c√≥digo buscaba dropdowns sin verificar primero qu√©
                    modal apareci√≥.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Re-verificar botones antes de
                    buscar dropdowns.
                    <pre>await trigger.click()
# Re-check: ¬øapareci√≥ Continuar o Confirmar?
if await continue_btn.is_visible(): ...
if await confirm_btn.is_visible(): ...
# SOLO entonces buscar dropdowns</pre>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-005 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-005: Selector de precio Ol√≠mpica roto</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Ol√≠mpica migr√≥ de
                    <code>.vtex-product-price-1-x-sellingPriceValue</code> a clases custom
                    <code>.olimpica-dinamic-flags-0-x-currencyContainer</code>.
                </div>
                <pre>Viejo (roto): .vtex-product-price-1-x-sellingPriceValue
Nuevo (OK):   .olimpica-dinamic-flags-0-x-currencyContainer</pre>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Actualizar selector en BD y en
                    el scraper.<br>
                    Verificado con JavaScript: <code>currencyExists: true, text: "$ 26.990"</code>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-006 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-006: URL de producto Ol√≠mpica retorna 404</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Ol√≠mpica cambia slugs de producto frecuentemente (a√±ade sufijos de
                    SKU/EAN).
                </div>
                <pre>404: /aceite-diana-mezcla-vegetales-vitamina-a-d-3000-ml/p
 OK: /aceite-medalla-oro-mezc-veget-3000-ml/p ($19.990)</pre>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> B√∫squeda por t√©rmino gen√©rico
                    ("aceite 3000") para encontrar la URL actual del m√°s barato, en vez de usar URLs fijas. Esto motiv√≥
                    la evoluci√≥n al scraper de b√∫squeda inteligente.
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-007 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-007: Precio D1 Aceite de Coco incorrecto ($39.900 vs $10.450)</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> El precio almacenado ($39.900) no coincid√≠a con el precio real de D1
                    ($10.450 Natri 210ml). Posible error del CSV de importaci√≥n original o scraper que ley√≥ un selector
                    incorrecto.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Correcci√≥n manual en BD:
                    <pre>UPDATE precios_tiendas SET precio = 10450
WHERE producto_id = 194 AND tienda = 'D1'
ORDER BY fecha_registro DESC LIMIT 1;</pre>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-008 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-008: Bloque except duplicado en Python</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Error de edici√≥n ‚Äî qued√≥ un bloque <code>except Exception</code>
                    residual de una refactorizaci√≥n anterior, causando <code>SyntaxError</code>.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Eliminar el bloque except
                    duplicado (l√≠neas 107-108).
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-009 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-009: Variantes de b√∫squeda ‚Äî "3000" vs "3.000" dan resultados diferentes</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> En D1, buscar "aceite 3000" muestra 0 resultados, pero "aceite
                    3.000" muestra 2 (Imat√° $22.850 y Don Olio $26.850). Los motores de b√∫squeda distintos tratan los
                    puntos de miles de forma diferente.
                </div>
                <div class="solution winner">
                    <strong><span class="tag tag-ok">SOLUCI√ìN DEFINITIVA</span></strong> Funci√≥n
                    <code>generar_variantes(termino)</code> que crea autom√°ticamente todas las combinaciones:
                    <pre>"aceite 3000" ‚Üí [
  "aceite 3000",
  "aceite 3.000",
  "aceite 3000ml",
  "aceite 3.000 ml",
  "aceite 3000 ml"
]</pre>
                    El scraper busca con TODAS las variantes y combina+deduplica resultados para encontrar el verdadero
                    m√°s barato.
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ERR-010 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="error-entry">
            <div class="error-header">
                <h3>ERR-010: 0 resultados en b√∫squeda VTEX ‚Äî selectores de cards</h3>
                <span class="tag tag-date">15/02/2026</span>
            </div>
            <div class="error-body">
                <div class="error-cause">
                    <strong>üìç Causa Ra√≠z:</strong> Los selectores de resultados de b√∫squeda
                    (<code>.vtex-product-summary-2-x-container</code>) no capturan los cards de producto en D1 ni en
                    Ol√≠mpica. D1 usa React con styled-components (clases din√°micas como
                    <code>styles__StyledCard-sc-3jvmda-0</code>).
                </div>
                <pre>üîé 'aceite 3000' ‚Üí 0 resultado(s)
üîé 'aceite 3.000' ‚Üí 0 resultado(s)</pre>
                <div class="solution failed">
                    <strong><span class="tag tag-fail">EN INVESTIGACI√ìN</span></strong> Necesario inspeccionar el DOM
                    real de b√∫squeda de cada tienda para identificar los selectores correctos de cards, nombres y
                    precios. El fallback a URLs directas funciona correctamente mientras se resuelve.
                </div>
            </div>
        </div>

        <footer class="footer">
            Documento generado por Agente Documentador T√©cnico Pro | 15 de Febrero 2026 | Despensa Inteligente ‚Äî Santa
            Marta
        </footer>
    </div>
</body>

</html>